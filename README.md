# Android Virtual Cam

[简体中文](./README.md) | [繁體中文](./README_tc.md) | [English](./README_en.md)

基于 Xposed 的安卓虚拟摄像头模块。

> ⚠️ 请勿用于任何非法用途，所有后果自负。

## 快速了解
- **平台要求**：安卓 7.0 及以上。
- **源码镜像**：中国大陆加速地址（Gitee）：https://gitee.com/w2016561536/android_virtual_cam

## 安装与启用
1. 安装模块并在 Xposed 中启用。若使用 LSPosed 等带作用域的框架，只需勾选目标应用，无需勾选系统框架。
2. 在系统设置中授予目标应用“读取本地存储”权限，然后强制停止该应用。若应用不申请该权限，继续看下一步。
3. 打开目标应用：
   - 如果缺少存储权限，会出现气泡提示：`Camera1` 已重定向到私有目录 `/[内部存储]/Android/data/[应用包名]/files/Camera1/`。
   - 如果无提示，则默认目录为 `/[内部存储]/Download/Camera1/`。目录不存在请手动创建，或用应用内“选择目录”自动创建。
   - **提示**：私有目录下的 `Camera1` 仅对当前应用生效。

## 准备替换素材
1. 在目标应用打开相机预览时，气泡消息会显示分辨率（示例：“宽：... 高：...”）。根据该分辨率制作替换视频，命名为 `virtual.mp4`，放到 `Camera1` 目录。若无提示，可直接使用原视频分辨率。也可在应用内“选择照片→生成视频”，自动导出 `virtual.mp4`。
2. 如果拍照仍显示真实照片且收到 `发现拍照` 提示及分辨率，请按提示分辨率准备一张图片，命名为 `1000.bmp`，放入 `Camera1` 目录（其他格式更名为 .bmp 亦可）。若无提示，则无需该文件。
3. 可选开关（全局实时生效，均放在当前 `Camera1` 目录，可在应用内快速配置）：
   - 播放视频声音：创建 `no-silent.jpg`。
   - 临时停用视频替换：创建 `disable.jpg`。
   - 关闭 Toast 提示：创建 `no_toast.jpg`。
   - 重新显示目录重定向提示：创建 `force_show.jpg`。
   - 每个应用独立视频目录：创建 `private_dir.jpg`（强制使用应用私有目录）。
4. 应用内提供“检测素材”，会校验 `virtual.mp4` 是否存在、是否可解码、分辨率是否匹配，并给出提示。
5. 若缺少 `virtual.mp4`，系统会显示常驻通知提醒当前目录。

## 常见问题
- **前置摄像头方向异常**：通常需要将前置视频水平翻转并右旋 90°，并确保处理后的分辨率与气泡提示一致；也可能不需要翻转，请以实际效果为准。
- **黑屏或相机启动失败**：部分应用（尤其是系统相机）可能不支持替换；或路径层级错误（只需单级 `DCIM/Camera1`，不要嵌套多级）。
- **花屏**：视频分辨率不匹配，请按提示分辨率重新导出。
- **画面扭曲/变形**：使用剪辑软件调整视频比例以匹配屏幕。
- **`disable.jpg` 无效**：
  - 应用版本 ≤ 4.0：`/[内部存储]/DCIM/Camera1/` 仅对有存储权限的应用生效，其余应用需在私有目录创建。
  - 应用版本 ≥ 4.1：统一在 `/[内部存储]/DCIM/Camera1/` 创建，与目标应用权限无关。

## 反馈
如遇问题请在 Issues 中反馈；提交 BUG 请附带 Xposed **模块**日志。

## 致谢
- 提供 HOOK 思路：https://github.com/wangwei1237/CameraHook
- H264 硬解码： https://github.com/zhantong/Android-VideoToImages
- JPEG 转 YUV： https://blog.csdn.net/jacke121/article/details/73888732
